---
import { Icon } from 'astro-icon/components';

type Variant = 'default' | 'secondary' | 'outline' | 'success' | 'warning' | 'danger';
type Size = 'sm' | 'md';
type IconPosition = 'left' | 'right';

interface Props {
  variant?: Variant;
  size?: Size;
  icon?: string;
  iconPosition?: IconPosition;
  class?: string;
  [key: string]: unknown;
}

const {
  variant = 'default',
  size = 'md',
  icon,
  iconPosition = 'left',
  class: className = '',
  ...rest
} = Astro.props;

const hasIcon = typeof icon === 'string' && icon.trim().length > 0;
---

<span
  class:list={['badge', className]}
  data-variant={variant}
  data-size={size}
  data-icon-position={iconPosition}
  data-has-icon={hasIcon ? 'true' : 'false'}
  {...rest}
>
  {hasIcon && <Icon name={icon} aria-hidden='true' />}

  <slot />
</span>

<style>
  .badge {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid transparent;
    font-weight: 600;
    line-height: 1;
    white-space: nowrap;
    user-select: none;
    color: var(--text-muted);

    /* Layout: cuando hay icono */
    &[data-has-icon='true'] {
      gap: 0.4cap;
    }

    /* Sizes */
    &[data-size='sm'] {
      padding: 0.35rem 0.6rem;
      font-size: 1.2rem;
    }

    &[data-size='md'] {
      padding: 0.45rem 0.75rem;
      font-size: 1.3rem;
    }

    /* Ajuste fino cuando hay icono */
    &[data-has-icon='true'] {
      & > [data-icon] {
        width: 1.5cap;
        height: 1.5cap;
        display: block;
        flex-shrink: 0;
        stroke-width: 2;
      }

      &[data-size='sm'] {
        padding-inline: 0.55rem;
      }

      &[data-size='md'] {
        padding-inline: 0.7rem;
      }

      &[data-icon-position='right'] {
        flex-direction: row-reverse;
      }
    }
  }

  /* Variants */
  .badge[data-variant='default'] {
    background: color-mix(in oklab, var(--info) 14%, var(--gray-200));
    border-color: color-mix(in oklab, var(--info) 35%, var(--border-color));
  }

  .badge[data-variant='secondary'] {
    background: color-mix(in oklab, var(--border-color) 55%, var(--gray-200));
    border-color: var(--border-color);
  }

  .badge[data-variant='outline'] {
    background: transparent;
    border-color: var(--border-color);
  }

  .badge[data-variant='success'] {
    background: color-mix(in oklab, var(--success) 16%, var(--gray-200));
    border-color: color-mix(in oklab, var(--success) 40%, var(--border-color));
  }

  .badge[data-variant='warning'] {
    background: color-mix(in oklab, var(--warning) 18%, var(--gray-200));
    border-color: color-mix(in oklab, var(--warning) 45%, var(--border-color));
  }

  .badge[data-variant='danger'] {
    background: color-mix(in oklab, var(--error) 14%, var(--gray-200));
    border-color: color-mix(in oklab, var(--error) 40%, var(--border-color));
  }

  /* Color del icono por variante (opcional) */
  .badge[data-variant='default'] [data-icon] {
    color: var(--info);
  }

  .badge[data-variant='success'] [data-icon] {
    color: var(--success);
  }

  .badge[data-variant='warning'] [data-icon] {
    color: var(--warning);
  }

  .badge[data-variant='danger'] [data-icon] {
    color: var(--error);
  }
</style>
