---
import caseStudies from '@/data/case-studies.json';
import type {
  CaseStudy,
  DevelopmentWithSituation,
  DevelopmentWithSteps,
} from '@/types/case-study';

import AccordionContent from '../ui/accordion/AccordionContent.astro';
import AccordionItem from '../ui/accordion/AccordionItem.astro';
import TopicAccordionTrigger from './TopicAccordionTrigger.astro';

interface Props {
  topic: keyof typeof caseStudies;
  isNational?: boolean;
}

const { topic, isNational = false } = Astro.props;
const allCases = caseStudies[topic] as CaseStudy[];
const cases = allCases.filter(
  (caseStudy) => (caseStudy.isNational ?? false) === isNational,
);
---

{
  cases.length === 0 ? (
    <p>No hay estudios de caso disponibles para este tema.</p>
  ) : (
    cases.map(({ title, description, development, lessons }) => (
      <AccordionItem>
        <TopicAccordionTrigger title={title} />

        <AccordionContent>
          <p>{description}</p>

          <h5>Desarrollo:</h5>
          {Object.prototype.hasOwnProperty.call(development, 'steps') ? (
            <>
              <p>{(development as DevelopmentWithSteps).intro}</p>
              <ol>
                {(development as DevelopmentWithSteps).steps.map((step) => (
                  <li>{step}</li>
                ))}
              </ol>
              <p>{(development as DevelopmentWithSteps).outro}</p>
            </>
          ) : Object.prototype.hasOwnProperty.call(development, 'situation') ? (
            <>
              <p>
                <strong>Situación inicial:</strong>{' '}
                {(development as DevelopmentWithSituation).situation}
              </p>
              <p>
                <strong>Problemas identificados:</strong>
              </p>
              <ol>
                {(development as DevelopmentWithSituation).problems.map((problem) => (
                  <li>{problem}</li>
                ))}
              </ol>
              <p>
                <strong>Solución implementada:</strong>{' '}
                {(development as DevelopmentWithSituation).solution.summary}
              </p>
              <ol>
                {(development as DevelopmentWithSituation).solution.modules.map(
                  (module) => (
                    <li>{module}</li>
                  ),
                )}
              </ol>
              <p>
                <strong>Resultados:</strong>{' '}
                {(development as DevelopmentWithSituation).results}
              </p>
            </>
          ) : (
            <p>{development as string}</p>
          )}

          <h5>Lecciones aprendidas:</h5>
          <p>{lessons}</p>
        </AccordionContent>
      </AccordionItem>
    ))
  )
}
